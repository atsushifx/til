---
title: 2025-06
layout: default
---

## 2025年6月分

### 2025年6月2日 -- ESTA開発: errorによる実行制御の要件定義

#### 🔧 今日のテーマ

プロセス終了処理 (`process.exit`) の一元化とログ出力・exitCode 制御の分離。
CLI / Node.js ツールにおける「異常終了」と「制御可能エラー」の切り分け設計を行なった。

#### ✅ 導入する構成と機能

### 1. `fatalExit(code, message)`

- 標準エラー出力にログを出力
- 即時 `process.exit(code)`
- 制御は戻らず強制終了

### 2. `errorExit(code, message)`

- カスタム例外 `ExitError` を throw
- 上位で `try...catch` により補足・制御可能

#### 📦 `ExitError` の実装

- `Error` を拡張
- `code: ExitCode` を保持
- `instanceof` 判定・stacktrace 対応済み

#### 🔢 `ExitCode` enum の管理

```ts
export enum ExitCode {
  SUCCESS = 0,
  ERR_UNKNOWN = 1,
  ERR_CONFIG_NOT_FOUND = 2,
  ERR_COMMAND_EXECUTION = 3,
  ERR_INVALID_ARGS = 4, // ← 追加
}
```

#### 📊 errorLevel グローバル構想

- `Log.error()` 時に `errorLevel` を記録
- `errorLevel > 0` で最終的に `fatalExit(errorLevel)`
- ログ出力にはログレベル不要、処理判断目的に限定

#### 📁 構成方針

| 要素 | パス案 |
|------|--------|
| fatalExit / errorExit | `@ag-system/exit-handlers` |
| ExitCode 定義 | `@shared/types/exitCode.ts` |
| ExitError クラス | `src/system/ExitError.ts` or `src/errors/ExitError.ts` |

## 📝 所感・補足

- `throw` によるエラー制御は柔軟かつ再利用性が高い
- fatal と error の二層構造で CLI の信頼性向上
- enum によるエラーコードの定義はロギング・CI との連携に有効

---
